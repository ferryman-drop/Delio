# üìã –ü—ñ–¥—Å—É–º–æ–∫ –°–µ—Å—ñ—ó –†–µ–≤—é - 2026-02-04

## üéØ –í–∏–∫–æ–Ω–∞–Ω—ñ –ó–∞–¥–∞—á—ñ
–¶—è —Å–µ—Å—ñ—è –±—É–ª–∞ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∞ –Ω–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏, –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –ø–∞–º'—è—Ç—ñ —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Å–µ–Ω—Å–æ—Ä–Ω–∏—Ö –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π (–ó—ñ—Ä, –ì–æ–ª–æ—Å).

### 1. üõ°Ô∏è TASK-004: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è "–ü–æ–±—ñ—á–Ω–æ–≥–æ –ö–∞–Ω–∞–ª—É" –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
**–ú–µ—Ç–∞**: –ó–∞–ø–æ–±—ñ–≥—Ç–∏ "—Å—Ç–∞–Ω–∫–∞–º –≥–æ–Ω–∏—Ç–≤–∏", –∫–æ–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è, –î–∞–π–¥–∂–µ—Å—Ç–∏) –ø–µ—Ä–µ–±–∏–≤–∞–ª–∏ –∞–∫—Ç–∏–≤–Ω—É —Å–µ—Å—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –æ–º–∏–Ω–∞–ª–∏ FSM.

**–î–µ—Ç–∞–ª—ñ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**:
- **–ü–æ—Å–∏–ª–µ–Ω–Ω—è StateGuard**:
    - –î–æ–¥–∞–Ω–æ `State.NOTIFY` —Ç–∞ –¥—ñ—é `Action.SYSTEM_NOTIFICATION`.
    - –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ `try_enter_notify(user_id)`: –Ω–µ–±–ª–æ–∫—É—é—á–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø–∏—Ç—É –¥–æ–∑–≤–æ–ª—É –Ω–∞ "—Å–ª–æ–≤–æ" —Ñ–æ–Ω–æ–≤–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏.
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ReminderTool**:
    - –¢–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `try_enter_notify`.
    - **–†–æ–∑—É–º–Ω–µ –ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è**: –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–π–Ω—è—Ç–∏–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Å—Ç–∞–Ω—ñ `ACT`), –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ +30—Å.
    - **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ü–∞–º'—è—Ç—ñ**: –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ —ñ—Å—Ç–æ—Ä—ñ—é.
- **–û–Ω–æ–≤–ª–µ–Ω–Ω—è Scheduler**:
    - –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ –æ–±–≥–æ—Ä—Ç–∫—É `safe_send_message` –¥–ª—è –≤—Å—ñ—Ö —Ñ–æ–Ω–æ–≤–∏—Ö –∑–∞–≤–¥–∞–Ω—å (–†–∞–Ω–∫–æ–≤–∏–π –ë—Ä–∏—Ñ—ñ–Ω–≥, –©–æ–¥–µ–Ω–Ω–∏–π –î–∞–π–¥–∂–µ—Å—Ç).

**–ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏**:
- `core/state.py`
- `core/state_guard.py`
- `core/tools/reminder_tool.py`
- `scheduler.py`

---

### 2. üß† TASK-006: Context Funnel (–°–∏—Å—Ç–µ–º–∞ –ü–∞–º'—è—Ç—ñ)
**–ú–µ—Ç–∞**: –í–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É "–°–ª—ñ–ø–æ–≥–æ –ë–æ—Ç–∞" —à–ª—è—Ö–æ–º –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó –≤—Å—ñ—Ö —à–∞—Ä—ñ–≤ –ø–∞–º'—è—Ç—ñ (–ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–æ—ó, –î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤–æ—ó, –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ—ó) –≤ —î–¥–∏–Ω–∏–π –æ–±'—î–∫—Ç –ø—ñ–¥ —á–∞—Å —Å—Ç–∞–Ω—É `RETRIEVE`.

**–î–µ—Ç–∞–ª—ñ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**:
- **ContextFunnel (`core/memory/funnel.py`)**:
    - –°—Ç–≤–æ—Ä–µ–Ω–æ —Å—ñ–Ω–≥–ª—Ç–æ–Ω –¥–ª—è —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö.
    - **–î–∂–µ—Ä–µ–ª–æ 1 (–ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–∞)**: Redis (–æ—Å—Ç–∞–Ω–Ω—ñ 10 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å).
    - **–î–∂–µ—Ä–µ–ª–æ 2 (–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞)**: SQLite (–ü—Ä–æ—Ñ—ñ–ª—å Life OS, –¶—ñ–ª—ñ, –ù–∞–≤–∏—á–∫–∏).
    - **–î–∂–µ—Ä–µ–ª–æ 3 (–î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤–∞)**: ChromaDB (–í–µ–∫—Ç–æ—Ä–Ω–∏–π –°–µ–º–∞–Ω—Ç–∏—á–Ω–∏–π –ü–æ—à—É–∫).
- **Graceful Degradation**: –ö–æ–∂–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –∑–∞—Ö–∏—â–µ–Ω–µ –±–ª–æ–∫–æ–º `try/except`, —â–æ–± –∑–±—ñ–π Redis –Ω–µ –≤–∞–ª–∏–≤ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å.
- **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**: `RetrieveState` —Ç–µ–ø–µ—Ä –≤–∏–∫–ª–∏–∫–∞—î `funnel.aggregate_context`.

**–ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏**:
- `core/memory/funnel.py` (–ù–æ–≤–∏–π)
- `states/retrieve.py`

---

### 3. üé≠ TASK-005: –£–º–æ–≤–Ω–∞ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è (–ú—ñ—Å—Ç Actor-Critic)
**–ú–µ—Ç–∞**: –ó–∞–ø–æ–±—ñ–≥—Ç–∏ "–¢–∏—Ö–∏–º –ó–±–æ—è–º" —Ç–∞ –ø–æ—à–∏—Ä–µ–Ω–Ω—é –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É —à–ª—è—Ö–æ–º –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤–∏–≤–æ–¥—É –ú–æ–¥–µ–ª—ñ –ø–µ—Ä–µ–¥ –¥—ñ—î—é.

**–î–µ—Ç–∞–ª—ñ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**:
- **–ü–æ—Å–∏–ª–µ–Ω–Ω—è PlanState**:
    - –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö `model_used` –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –º–∞—Ä–∫–µ—Ä—É "‚ö†Ô∏è" (–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –ö—Ä–∏—Ç–∏–∫–æ–º).
    - –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –ø–æ—Ä–æ–∂–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.
- **–û–±—Ä–æ–±–∫–∞ –ü–æ–º–∏–ª–æ–∫**:
    - –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—é –¥–æ `State.ERROR` —É —Ä–∞–∑—ñ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è.
    - `ErrorState` —Ç–µ–ø–µ—Ä –Ω–∞–¥–∞—î –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ñ –≤–∏–±–∞—á–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–ú–æ—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–ø–µ–∫–∏ –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∞ —Ü—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å").

**–ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏**:
- `states/plan.py`
- `states/error.py`

---

### 4. üëÅÔ∏è TASK-007, 008, 009: –°–µ–Ω—Å–æ—Ä–∏–∫–∞ —Ç–∞ –ë–µ–∫–∞–ø (–§–∞–∑–∞ 3.3)
**–ú–µ—Ç–∞**: –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ó–æ—Ä—É/–ì–æ–ª–æ—Å—É —Ç–∞ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞–Ω —è–¥—Ä–∞.

**–î–µ—Ç–∞–ª—ñ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**:
- **–ó—ñ—Ä (Vision)**:
    - `handle_photo` –≤ `handlers.py` –∑–∞—Ö–æ–ø–ª—é—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.
    - `llm_service.py` –º—ñ–≥—Ä–æ–≤–∞–Ω–æ –Ω–∞ `google.genai` –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ.
- **–ì–æ–ª–æ—Å (Voice)**:
    - –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ `edge-tts` —á–µ—Ä–µ–∑ `core/tts_service.py` (–ì–æ–ª–æ—Å: –û—Å—Ç–∞–ø).
    - –†–∞–Ω–∫–æ–≤–∏–π –ë—Ä–∏—Ñ—ñ–Ω–≥ —Ç–µ–ø–µ—Ä –Ω–∞–¥—Å–∏–ª–∞—î –≥–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –¥–æ–≤–≥–∏—Ö –ø—ñ–¥—Å—É–º–∫—ñ–≤.
- **–ë–µ–∫–∞–ø –Ø–¥—Ä–∞**:
    - –°–∫—Ä–∏–ø—Ç `scripts/freeze_kernel.py` —Å—Ç–≤–æ—Ä—é—î —á–∏—Å—Ç–∏–π zip-–∞—Ä—Ö—ñ–≤ —è–¥—Ä–∞ —Å–∏—Å—Ç–µ–º–∏.

**–ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏**:
- `handlers.py`, `core/fsm.py`, `core/llm_service.py`, `states/plan.py`
- `core/tts_service.py` (–ù–æ–≤–∏–π), `scheduler.py`
- `scripts/freeze_kernel.py` (–ù–æ–≤–∏–π)

---

## üîç –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- **–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –¢–µ—Å—Ç–∏**:
    - `tests/test_funnel_manual.py` –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ –∫–æ—Ä–µ–∫—Ç–Ω—É –∞–≥—Ä–µ–≥–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö.
    - `tests/test_task_005_routing.py` –ø–µ—Ä–µ–≤—ñ—Ä–∏–≤ –ª–æ–≥—ñ–∫—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó –ø–æ–º–∏–ª–æ–∫.
    - **–ë–µ–∫–∞–ø –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ**: –£—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∞—Ä—Ö—ñ–≤ ~0.20 MB.
- **–°—Ç–∞—Ç—É—Å**: –í—Å—ñ –∑–∞–¥–∞—á—ñ (004-009) –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ **–í–ò–ö–û–ù–ê–ù–û**.

## üîú –ù–∞—Å—Ç—É–ø–Ω—ñ –ö—Ä–æ–∫–∏
- **–ü–û–ß–ê–¢–û–ö –§–ê–ó–ò 4**: –ü–æ–≤–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –ª–µ–≥–∞—Å—ñ-–∫–æ–¥—É —Ç–∞ –æ—á–∏—â–µ–Ω–Ω—è.
- **–ó–ª–∏—Ç—Ç—è**: –í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –≥—ñ–ª–∫–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ main.
