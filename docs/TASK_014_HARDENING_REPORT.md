# üõ°Ô∏è TASK-014: Kernel Hardening & Observability

## üéØ –ú–µ—Ç–∞
–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ "—á–∏—Å—Ç–∏–π –∫–µ—Ä–Ω–µ–ª" (Clean Kernel) —á–µ—Ä–µ–∑ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –Ω–∞—Å–∫—Ä—ñ–∑–Ω–æ–≥–æ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è (Tracing), —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ —Å–∏—Å—Ç–µ–º–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å.

## ‚öôÔ∏è –î–µ—Ç–∞–ª—ñ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### 1. Context Tracing (`core/context.py`)
- –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `trace_id` (UUIDv4) –¥–æ `ExecutionContext`.
- –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ `contextvars` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ–∫–∏–¥–∞–Ω–Ω—è `trace_id` —É –≤—Å—ñ –ª–æ–≥–∏ –≤ –º–µ–∂–∞—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

### 2. JSON Logging (`core/logger.py`)
- –°—Ç–≤–æ—Ä–µ–Ω–æ `JSONFormatter`, —è–∫–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É—î –ª–æ–≥–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON.
- –ü–æ–ª—è: `timestamp`, `level`, `message`, `module`, `line`, `trace_id`.
- –õ–æ–≥–∏ –ø–∏—à—É—Ç—å—Å—è —É `logs/delio_trace.json` (Trace) —Ç–∞ –¥—É–±–ª—é—é—Ç—å—Å—è —É –∫–æ–Ω—Å–æ–ª—å (Readable).

### 3. Critical Alerting (`core/state_guard.py`)
- `StateGuard` —Ç–µ–ø–µ—Ä –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Å—Ç–∞–Ω—Å—É –±–æ—Ç–∞ (`set_bot`).
- –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ "–∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥—É" (Forbidden Transition) –∞–±–æ Deadlock, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
- –§–æ—Ä–º–∞—Ç –∞–ª–µ—Ä—Ç—É:
  > üö® **CRITICAL GUARD FAILURE**
  > Context: Forbidden Transition
  > User: `12345`
  > Error: `RuntimeError: ...`

### 4. FSM Integration (`core/fsm.py`)
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –æ–±—Ä–æ–±–∫–∏ –ø–æ–¥—ñ—ó (`process_event`) –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π `trace_id` —ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è —É `contextvar`.
- –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –≤—Å—ñ –ª–æ–≥–∏, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ —Ü—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–∞–≤—ñ—Ç—å —É –≥–ª–∏–±–æ–∫–æ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö), –º–∞—Ç–∏–º—É—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π `trace_id`.

## üß™ –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- **–°–∫—Ä–∏–ø—Ç**: `scripts/test_trace_alert.py`.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏**:
  - ‚úÖ –õ–æ–≥–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è —É JSON –∑ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º–∏ `trace_id`.
  - ‚úÖ –°–∏–º—É–ª—è—Ü—ñ—è –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥—É –≤–∏–∫–ª–∏–∫–∞–ª–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∞–ª–µ—Ä—Ç —É Mock-–±–æ—Ç–∞.

## üîú –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä –≥–æ—Ç–æ–≤–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–µ–±–∞–≥—ñ–Ω–≥—É. –£ —Ä–∞–∑—ñ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∑–±–æ—ó–≤ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –º–∏—Ç—Ç—î–≤–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ Telegram, –∞ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ `logs/delio_trace.json` –∑–∞ `trace_id` –∞–±–æ User ID.
