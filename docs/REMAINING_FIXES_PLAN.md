# üõ† –ü–õ–ê–ù –í–ò–ü–†–ê–í–õ–ï–ù–¨ –î–õ–Ø DELIO KERNEL (V4.1)

## –ï–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ù–ê –ë–ï–ó–ü–ï–ö–ê (–ù–ï–ì–ê–ô–ù–û)

### 1.1 –ó–∞–∫—Ä–∏—Ç–∏ RCE —É `execute_python`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `subprocess_exec` –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å.
- **–î—ñ—è:** –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `RestrictedPython` –∞–±–æ (–∫—Ä–∞—â–µ) –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Ç–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø—É –¥–æ –º–µ—Ä–µ–∂—ñ.
- **–§–∞–π–ª:** `tools.py:59`

### 1.2 –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø—ñ–¥–º—ñ–Ω—É `user_id` —É —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** `ActState` –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ `user_id` –∑–æ–≤–Ω—ñ.
- **–î—ñ—è:** –ü—Ä–∏–º—É—Å–æ–≤–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ `user_id` –≤ `tool_args` –∑–Ω–∞—á–µ–Ω–Ω—è–º —ñ–∑ `ExecutionContext`, —ñ–≥–Ω–æ—Ä—É—é—á–∏ —Ç–µ, —â–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–∞ LLM.
- **–§–∞–π–ª:** `states/act.py:35`

### 1.3 –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ Path Traversal
- **–ü—Ä–æ–±–ª–µ–º–∞:** `read_project_file` –ø—Ä–∏–π–º–∞—î –±—É–¥—å-—è–∫–∏–π —à–ª—è—Ö.
- **–î—ñ—è:** –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —à–ª—è—Ö—É ‚Äî –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —á–∏—Ç–∞–Ω–Ω—è –ª–∏—à–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É, –∑–∞–±–æ—Ä–æ–Ω–∏–≤—à–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `..` —Ç–∞ –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö —à–ª—è—Ö—ñ–≤.
- **–§–∞–π–ª:** `tools.py:149`

---

## –ï–¢–ê–ü 2: –°–¢–ê–ë–Ü–õ–¨–ù–Ü–°–¢–¨ –¢–ê –ü–ê–†–ê–õ–ï–õ–Ü–ó–ú

### 2.1 –£—Å—É–Ω–µ–Ω–Ω—è Race Condition —É —Å—Ç–∞–Ω–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ —Å–∫–∏–¥–∞—î —Å—Ç–∞–Ω —É `IDLE` –ø—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏ FSM.
- **–î—ñ—è:** 
    1. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `guard.force_idle(user_id)` —É `fsm.py` –≤—Å–µ—Ä–µ–¥–∏–Ω—É –±–ª–æ–∫—É `async with session_lock`.
    2. –£ `scheduler.py` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `session_lock` –ø–µ—Ä–µ–¥ —Å–ø—Ä–æ–±–æ—é –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞–Ω.
- **–§–∞–π–ª–∏:** `core/fsm.py`, `scheduler.py`, `core/state_guard.py`

### 2.2 –ë–æ—Ä–æ—Ç—å–±–∞ –∑ –≤–∏—Ç–æ–∫–æ–º –ø–∞–º'—è—Ç—ñ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–≤–Ω–∏–∫–∏ `_session_locks` —Ç–∞ `_user_states` —Ä–æ—Å—Ç—É—Ç—å –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ.
- **–î—ñ—è:** –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –æ—á–∏—â–µ–Ω–Ω—è (Cleanup Job). –í–∏–¥–∞–ª—è—Ç–∏ –∑–∞–ø–∏—Å–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –±—É–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ñ –ø–æ–Ω–∞–¥ 24 –≥–æ–¥–∏–Ω–∏.
- **–§–∞–π–ª–∏:** `core/fsm.py`, `core/state_guard.py`

---

## –ï–¢–ê–ü 3: –õ–û–ì–Ü–ö–ê –¢–ê –Ø–ö–Ü–°–¢–¨ –†–û–ë–û–¢–ò

### 3.1 –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ "SKIP" —É Heartbeat-—Ü–∏–∫–ª—ñ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö—Ä–∏—Ö–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ `startswith`.
- **–î—ñ—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ `re.search(r'\bSKIP\b', text, re.I)` –∞–±–æ –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π —Å—Ç—Ä–∏–ø—ñ–Ω–≥ —Å–∏–º–≤–æ–ª—ñ–≤ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é.
- **–§–∞–π–ª:** `states/decide.py:25`

### 3.2 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞—Ä–±—ñ—Ç—Ä–∞–∂—É (Judge)
- **–ü—Ä–æ–±–ª–µ–º–∞:** Claude –ø—Ä–∞—Ü—é—î –ª–∏—à–µ —è–∫ fallback.
- **–î—ñ—è:** –î–æ–¥–∞—Ç–∏ –≤ `states/plan.py` –ª–æ–≥—ñ–∫—É –≤–∏–∫–ª–∏–∫—É `call_judge` –¥–ª—è "—Å–∫–ª–∞–¥–Ω–∏—Ö" –∞–±–æ "–∫—Ä–∏—Ç–∏—á–Ω–∏—Ö" –∑–∞–ø–∏—Ç—ñ–≤, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ Gemini —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ —É—Å–ø—ñ—à–Ω–æ.
- **–§–∞–π–ª:** `states/plan.py`

### 3.3 –û—á–∏—â–µ–Ω–Ω—è —Ö–º–∞—Ä–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ Gemini
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ê—É–¥—ñ–æ- —Ç–∞ —Ñ–æ—Ç–æ—Ñ–∞–π–ª–∏ –Ω–µ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∑ GenAI File API.
- **–î—ñ—è:** –î–æ–¥–∞—Ç–∏ `client.files.delete(name)` –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—ó –∞–±–æ –∞–Ω–∞–ª—ñ–∑—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.
- **–§–∞–π–ª:** `core/llm_service.py`

---

## –ï–¢–ê–ü 4: –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø –¢–ê –í–Ü–î–ú–û–í–û–°–¢–Ü–ô–ö–Ü–°–¢–¨

### 4.1 –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è Retries –¥–ª—è LLM
- **–î—ñ—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É `tenacity` –∞–±–æ –≤–ª–∞—Å–Ω—É –æ–±–≥–æ—Ä—Ç–∫—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö —Å–ø—Ä–æ–± –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö 429 (Rate Limit) —Ç–∞ 503.
- **–§–∞–π–ª:** `core/llm_service.py`

### 4.2 Connection Pooling –¥–ª—è SQLite
- **–î—ñ—è:** –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ `aiosqlite` –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—É–ª—É –∑'—î–¥–Ω–∞–Ω—å –∞–±–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ `StructuredMemory` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–µ—Ä—É—î –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –∑'—î–¥–Ω–∞–Ω—å –ø—Ä–∏ –≤–µ–ª–∏–∫—ñ–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.
- **–§–∞–π–ª:** `core/memory/structured.py`

---

## üèÅ –ß–ï–ö-–õ–ò–°–¢ –ü–ï–†–ï–í–Ü–†–ö–ò (DEFINITION OF DONE)
1. –ö–æ–º–∞–Ω–¥–∞ `os.system` –≤ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ Python –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É –¥–æ—Å—Ç—É–ø—É.
2. –°–ø—Ä–æ–±–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ `update_profile` –∑ —á—É–∂–∏–º `user_id` —É –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –æ–Ω–æ–≤–ª—é—î –ø—Ä–æ—Ñ—ñ–ª—å –ü–û–¢–û–ß–ù–û–ì–û –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
3. –ë–æ—Ç –Ω–µ "–ø–∞—Ü–∞—î" (–Ω–µ –ø–∏—à–µ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –¥—É–º–∫–∏) –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ "SKIP" —É —Ñ–æ–Ω—ñ.
4. –ü—ñ—Å–ª—è 24 –≥–æ–¥–∏–Ω —Ä–æ–±–æ—Ç–∏ RAM –Ω–µ –∑—Ä–æ—Å–ª–∞ –ª—ñ–Ω—ñ–π–Ω–æ.
